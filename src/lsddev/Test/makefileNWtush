# This is a special makefile for tush test models. 
# It is reused by all tush models and should remain one folder on top of the test folders.
# Parameters that need to be supplied as command line arguments:
# MODEL=test_0001_tush

# Model compilation options
# LSD options
FUN=$(MODEL)/fun_$(MODEL)
TARGET=$(MODEL)/lsd
SUFFIX_TUSH=Tush
TARGET_TUSH=$(TARGET)$(SUFFIX_TUSH)

# Additional model files
FUN_EXTRA=

# Compiler options
SWITCH_CC=-O0 -ggdb3
SWITCH_CC_LNK=

# System compilation options
# LSD options - we start in `LSD/src/lsddev/Test`
LSDROOT=../../..
SRC=../..

# Libraries options
PATH_HEADER=.
PATH_LIB=.
LIB=-lz -lpthread

# Compiler options
CC=g++
GLOBAL_CC=-march=native -w
SSWITCH_CC=-fnon-call-exceptions -O3

# Body of makefileNW (from makefile_NW.txt)
# specify where are the sources of LSD
SRC_DIR=$(SRC)/

# location of headers
INCLUDE=-I$(SRC) -I$(PATH_HEADER)

# common dependencies (all source files)
COM_DEP=$(SRC_DIR)decl.h $(SRC_DIR)common.h 

# no-window specific variables
LIB_NW=-lz -lpthread
CC_NW=$(CC_CROSS)g++
SWITCH_CC_NW=$(GLOBAL_CC) $(SWITCH_CC) -DNW -O3 -g0

# OS command to delete files
RM=rm -f

# link executable - use extra $(SUFFIX_TUSH) to not conflict with regular (manual) model creation.
$(TARGET_TUSH): $(FUN)$(SUFFIX_TUSH).o $(SRC_DIR)common.o $(SRC_DIR)lsdmain.o \
$(SRC_DIR)file.o $(SRC_DIR)nets.o $(SRC_DIR)object.o \
$(SRC_DIR)util.o $(SRC_DIR)variab.o
	$(CC_NW) $(SWITCH_CC_NW) $(FUN)$(SUFFIX_TUSH).o $(SRC_DIR)common.o \
	$(SRC_DIR)lsdmain.o $(SRC_DIR)file.o $(SRC_DIR)nets.o \
	$(SRC_DIR)object.o $(SRC_DIR)util.o $(SRC_DIR)variab.o \
	$(SWITCH_CC_LNK) -L$(PATH_LIB) $(LIB_NW) -o $(TARGET_TUSH)

# compile modules
$(FUN)$(SUFFIX_TUSH).o: $(FUN).cpp $(FUN_EXTRA) $(SRC_DIR)check.h \
$(SRC_DIR)fun_head.h $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(FUN).cpp -o $(FUN)$(SUFFIX_TUSH).o

$(SRC_DIR)common.o: $(SRC_DIR)common.cpp $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)common.cpp -o $(SRC_DIR)common.o

$(SRC_DIR)lsdmain.o: $(SRC_DIR)lsdmain.cpp $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)lsdmain.cpp -o $(SRC_DIR)lsdmain.o

$(SRC_DIR)file.o: $(SRC_DIR)file.cpp $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)file.cpp -o $(SRC_DIR)file.o

$(SRC_DIR)nets.o: $(SRC_DIR)nets.cpp $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)nets.cpp -o $(SRC_DIR)nets.o

$(SRC_DIR)object.o: $(SRC_DIR)object.cpp $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)object.cpp -o $(SRC_DIR)object.o

$(SRC_DIR)util.o: $(SRC_DIR)util.cpp $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)util.cpp -o $(SRC_DIR)util.o

$(SRC_DIR)variab.o: $(SRC_DIR)variab.cpp $(SRC_DIR)decl.h $(SRC_DIR)common.h
	$(CC_NW) $(SWITCH_CC_NW) $(INCLUDE) -c $(SRC_DIR)variab.cpp -o $(SRC_DIR)variab.o
	
# remove compiled files
clean:
	$(RM) $(SRC_DIR)*.o $(FUN)$(SUFFIX_TUSH).o $(TARGET_TUSH)*